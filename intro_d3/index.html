<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <script type="text/javascript" src="./d3/d3.min.js"></script>
  <style>
	  .high {
		  
		  fill:rgb(0,191,255);
	  }
	  .low {
	  	  fill:rgb(173,216,230);
	  }
  </style>
</head>

<body>
<svg></svg>
<script type="text/javascript">
	function draw(data){
        var margin = 100;
        var width = 600 - margin*2;
        var height = 450 - margin*2;
		
	    var margin = {top: 100, right: 20, bottom: 50, left: 150},
	    width = 600 - margin.left - margin.right,
	    height = 450 - margin.top - margin.bottom;
		
	 
	    var svg = d3.select("svg")
		    .attr("width",width+margin.left+margin.right)
		    .attr("height",height+margin.top+margin.bottom);
			
		// sort the data based on the bar frequency 	
		data.sort(function(a, b) {return b.number-a.number;});
		
		var xScale = d3.scaleBand()
		 .rangeRound([0, width])
		 .padding(0.05)
		 .domain(data.map(function(d) { return d.PW_LEVEL_9089; }));
		 
		 var yScale= d3.scaleLinear()
		 .range([0,height])
		 .domain([0, d3.max(data, function(d) { return d.number; })]);
		 
	     var xAxis = d3.axisTop(xScale);
	     
	     var yAxis = d3.axisLeft(yScale);
	     
		 // the inner frame for barplot 
	     var inner= svg.append('g')
	     .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')'); 
		 
		 var bar = inner.selectAll("g")
		 .data(data)
		 
		 .enter().append("g")
		 .attr("transform",function(d){return "translate("+xScale(d.PW_LEVEL_9089)+",0)"})
		 
		 
		 bar.append("rect")
         .attr("width",xScale.step()-1)
		 .attr("height",function(d){return yScale(d.number)})
		 .attr("class", function(d){
			 if (d.number>30000){
				 return "high";
			 }
			 else
				 return "low";
		 });
		 
		 inner.append("g").call(xAxis);
         inner.append("g").call(yAxis);
		 
		 // add legends
         svg.append("rect")
		 .attr("width",xScale.step()/3)
		 .attr("height",xScale.step()/4)
		 .attr("fill","#00BFFF")
		 .attr("x", margin.left+width/4)
		 .attr("y",margin.top+height+margin.bottom/3)
		 
		 svg.append("text")
		 .attr("x", margin.left+width/4 + 2*xScale.step()/5)
		 .attr("y", margin.top+height+margin.bottom/3+xScale.step()/6)
		 .text("number > 30000")
		 .attr("font-size","12");
		 
		 svg.append("rect")
		 .attr("width",xScale.step()/3)
		 .attr("height",xScale.step()/4)
		 .attr("fill","#ADD8E6")
		 .attr("x", margin.left+2*width/3)
		 .attr("y",margin.top+height+margin.bottom/3)
		 
		 svg.append("text")
		 .attr("x", margin.left+2*width/3 + 2*xScale.step()/5)
		 .attr("y", margin.top+height+margin.bottom/3+xScale.step()/6)
		 .text("number < 30000")
		 .attr("font-size","12");
		 
		 // add y axis label
         inner.append("text")
         .attr("transform", "rotate(-90)")
         .attr("y", -margin.left/2)
         .attr("x",-height / 2)
         .attr("font-size","12")
         .style("text-anchor", "middle")
         .text("Number of Applications"); 

		 
         
	 }
    
	
	 
	 d3.json("data.json",function(error,data){
 		if(error){
 			 console.log(error);
 		 }
 		 else{
 	 		data.number = +data.number; // coerce to number
 	 		draw(data);
 		 }
	 });
</script>
</body>
</html>